<!-- NEW: Wrapper to contain the component and apply consistent styling -->
<div class="dashboard-container">
  @let rm = room();
  @let currentView = view();

  <!-- UPDATED: The header now has a conditional back button -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1 class="room-name">{{ rm?.name || "Loading Dashboard..." }}</h1>
      <p class="room-description">
        Manage your room, edit the menu, and view incoming orders.
      </p>

      <div class="room-code-display">
        <span class="room-code-label">Guest Link:</span>
        <span class="room-code">{{ rm?.code }}</span>
        <button class="share-button" (click)="copyInviteLink()">
          <span>{{ copyButtonText() }}</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              d="M12.232 4.232a2.5 2.5 0 013.536 3.536l-1.225 1.224a.75.75 0 001.061 1.06l1.224-1.224a4 4 0 00-5.656-5.656l-3 3a4 4 0 00.225 5.865.75.75 0 00.977-1.138 2.5 2.5 0 01-.142-3.665l3-3z"
            />
            <path
              d="M8.603 14.908a2.5 2.5 0 01-3.536-3.536l1.225-1.224a.75.75 0 00-1.061-1.06l-1.224 1.224a4 4 0 005.656 5.656l3-3a4 4 0 00-.225-5.865.75.75 0 00-.977 1.138 2.5 2.5 0 01.142 3.665l-3 3z"
            />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Tab Navigation -->
  <div class="tabs">
    <button
      class="tab-button"
      [class.active]="currentView === 'orders'"
      (click)="navigate('orders')"
    >
      Live Orders
    </button>
    <button
      class="tab-button"
      [class.active]="currentView === 'menu'"
      (click)="navigate('menu')"
    >
      Menu
    </button>
  </div>

  <!-- Tab Content -->
  <div class="content">
    @if (currentView === "orders") {
      <ul class="order-list">
        @for (order of activeOrders(); track order.id) {
          <li class="order-item" (click)="viewOrderDetails(order)">
            <div class="order-details">
              <span class="order-drink-name">{{ order.drink.name }}</span>
              <span class="order-guest-name"
                >for {{ order.guest.display_name }}</span
              >
            </div>
            <span class="order-status" [ngClass]="'status-' + order.status">{{
              order.status
            }}</span>
          </li>
        } @empty {
          <div class="empty-orders">No active orders right now.</div>
        }
      </ul>
    }
    @if (currentView === "menu") {
      <pd-menu-editor [room]="room()"></pd-menu-editor>
    }
  </div>
</div>
@if (selectedOrder(); as order) {
  <div class="modal-backdrop" (click)="closeOrderModal()">
    <div class="modal-panel" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">{{ order.drink.name }}</h3>
        <span class="order-status" [ngClass]="'status-' + order.status">{{
          order.status
        }}</span>
      </div>

      <div class="modal-body">
        <p>
          Order for <strong>{{ order.guest.display_name }}</strong> placed at
          <strong>{{ order.created_at | date: "shortTime" }}</strong
          >.
        </p>
      </div>

      <div class="modal-actions">
        <button class="pd-button secondary" (click)="closeOrderModal()">
          Close
        </button>

        @if (order.status === "queued") {
          <button
            class="pd-button in-progress"
            (click)="updateOrderStatus(order.id, 'in-progress')"
          >
            Start Progress
          </button>
        }
        @if (order.status === "in-progress") {
          <button
            class="pd-button ready"
            (click)="updateOrderStatus(order.id, 'ready')"
          >
            Mark as Ready
          </button>
        }
        @if (order.status === "ready") {
          <button
            class="pd-button served"
            (click)="updateOrderStatus(order.id, 'served')"
          >
            Mark as Served
          </button>
        }
      </div>
    </div>
  </div>
}
