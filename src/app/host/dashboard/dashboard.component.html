<!-- NEW: Wrapper to contain the component and apply consistent styling -->
<div class="dashboard-container">
  @let rm = room();
  @let currentView = view();

  <!-- UPDATED: The header now has a conditional back button -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1 class="room-name">{{ rm?.name || "Loading Dashboard..." }}</h1>
      <p class="room-description">
        Manage your room, edit the menu, and view incoming orders.
      </p>
    </div>
    <div class="room-code-display">
      <span class="room-code-label">Code:</span>
      <span class="room-code">{{ rm?.code }}</span>
    </div>
  </header>

  <!-- Tab Navigation -->
  <div class="tabs">
    <button
      class="tab-button"
      [class.active]="currentView === 'orders'"
      (click)="navigate('orders')"
    >
      Live Orders
    </button>
    <button
      class="tab-button"
      [class.active]="currentView === 'menu'"
      (click)="navigate('menu')"
    >
      Menu
    </button>
    <button
      class="tab-button"
      [class.active]="currentView === 'share'"
      (click)="navigate('share')"
    >
      Share
    </button>
  </div>

  <!-- Tab Content -->
  <div class="content">
    @if (currentView === "orders") {
      <app-order-list [orders]="activeOrders()" (select)="viewOrderDetails($event)"></app-order-list>
    }
    @if (currentView === "menu") {
      <pd-menu-editor [room]="room()"></pd-menu-editor>
    }
    @if (currentView === "share") {
      <div class="share-tab">
        <div class="guest-link">
          <span class="room-code-label">Guest Link: </span>
          <a [href]="guestUrl()" target="_blank" rel="noopener">{{ guestUrl() }}</a>
        </div>
        <div class="qr-section">
          <tonic-qr-code [value]="guestUrl()" [size]="320" [level]="'M'"></tonic-qr-code>
        </div>
        
          <button class="share-button" (click)="copyInviteLink()">
            <tonic-icon [icon]="icons.Share"></tonic-icon>
            <span>{{ copyButtonText() }}</span>            
          </button>
        
      </div>
    }
  </div>
</div>
@if (selectedOrder(); as order) {
  <div class="modal-backdrop" (click)="closeOrderModal()">
    <div class="modal-panel" (click)="$event.stopPropagation()">
      <div class="modal-header">        
        <h3 class="modal-title">{{ order.drink.name }}</h3>
        <span class="order-status" [ngClass]="'status-' + order.status">{{
          order.status
        }}</span>
      </div>

      <div class="modal-body">
        <p>
          Order for <strong>{{ order.guest.display_name }}</strong> placed at
          <strong>{{ order.created_at | date: "shortTime" }}</strong
          >.
        </p>
      </div>

      <div class="modal-actions">
        <button class="pd-button secondary" (click)="closeOrderModal()">
          Close
        </button>

        @if (order.status === "queued") {
          <button
            class="pd-button in-progress"
            (click)="updateOrderStatus(order.id, 'in-progress')"
          >
            Start Progress
          </button>
        }
        @if (order.status === "in-progress") {
          <button
            class="pd-button ready"
            (click)="updateOrderStatus(order.id, 'ready')"
          >
            Mark as Ready
          </button>
        }
        @if (order.status === "ready") {
          <button
            class="pd-button served"
            (click)="updateOrderStatus(order.id, 'served')"
          >
            Mark as Served
          </button>
        }
      </div>
    </div>
  </div>
}
