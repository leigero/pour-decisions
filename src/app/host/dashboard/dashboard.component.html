<!-- NEW: Wrapper to contain the component and apply consistent styling -->
<div class="dashboard-container">
  @let rm = room();

  <!-- UPDATED: The header now has a conditional back button -->
  <header class="dashboard-header">
    <div class="header-content">
      <!-- NEW: Back button only appears when not on the main dashboard view -->
      @if (view2() !== "main") {
        <button class="back-button" (click)="navigate('main')">
          <!-- Heroicon: arrow-left -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z"
              clip-rule="evenodd"
            />
          </svg>
          <span>Dashboard</span>
        </button>
      }
      <h1 class="room-name">{{ rm?.name || "Loading Dashboard..." }}</h1>
      <p class="room-description">
        Manage your room, edit the menu, and view incoming orders.
      </p>

      <div class="room-code-display">
        <span class="room-code-label">Guest Link:</span>
        <span class="room-code">{{ rm?.code }}</span>
        <button class="share-button" (click)="copyInviteLink()">
          <span>{{ copyButtonText() }}</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              d="M12.232 4.232a2.5 2.5 0 013.536 3.536l-1.225 1.224a.75.75 0 001.061 1.06l1.224-1.224a4 4 0 00-5.656-5.656l-3 3a4 4 0 00.225 5.865.75.75 0 00.977-1.138 2.5 2.5 0 01-.142-3.665l3-3z"
            />
            <path
              d="M8.603 14.908a2.5 2.5 0 01-3.536-3.536l1.225-1.224a.75.75 0 00-1.061-1.06l-1.224 1.224a4 4 0 005.656 5.656l3-3a4 4 0 00-.225-5.865.75.75 0 00-.977 1.138 2.5 2.5 0 01.142 3.665l-3 3z"
            />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main class="content">
    <!-- UPDATED: Conditionally show the main dashboard hub or the router outlet -->
    @if (view2() === "main") {
      <div class="dashboard-grid">
        <!-- Card for Orders -->
        <div class="summary-card orders-card">
          <h2 class="card-title">Live Orders</h2>
          <p class="card-description">
            A summary of active drink orders from your guests.
          </p>
          <ul class="order-list">
            @for (order of activeOrders(); track order.id) {
              <li class="order-item" (click)="viewOrderDetails(order)">
                <div class="order-details">
                  <span class="order-drink-name">{{ order.drink.name }}</span>
                  <span class="order-guest-name"
                    >for {{ order.guest.display_name }}</span
                  >
                </div>
                <span
                  class="order-status"
                  [ngClass]="'status-' + order.status"
                  >{{ order.status }}</span
                >
              </li>
            } @empty {
              <div class="empty-orders">No active orders right now.</div>
            }
          </ul>
        </div>

        <!-- Card for Menu Management -->
        <div class="summary-card">
          <h2 class="card-title">Room Menu</h2>
          <p class="card-description">
            Select which drinks are available for guests to order.
          </p>
          <div class="card-actions">
            <button class="pd-button" (click)="navigate('menu')">
              <span>Edit Menu</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"
                />
                <path
                  d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
    } @else {
      <!-- The router-outlet is now only shown for child routes like 'menu-editor' -->
      <router-outlet></router-outlet>
    }
  </main>
</div>
@if (selectedOrder(); as order) {
  <div class="modal-backdrop" (click)="closeOrderModal()">
    <div class="modal-panel" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">{{ order.drink.name }}</h3>
        <span class="order-status" [ngClass]="'status-' + order.status">{{
          order.status
        }}</span>
      </div>

      <div class="modal-body">
        <p>
          Order for <strong>{{ order.guest.display_name }}</strong> placed at
          <strong>{{ order.created_at | date: "shortTime" }}</strong
          >.
        </p>
      </div>

      <div class="modal-actions">
        <button class="pd-button secondary" (click)="closeOrderModal()">
          Close
        </button>

        @if (order.status === "queued") {
          <button
            class="pd-button in-progress"
            (click)="updateOrderStatus(order.id, 'in-progress')"
          >
            Start Progress
          </button>
        }
        @if (order.status === "in-progress") {
          <button
            class="pd-button ready"
            (click)="updateOrderStatus(order.id, 'ready')"
          >
            Mark as Ready
          </button>
        }
        @if (order.status === "ready") {
          <button
            class="pd-button served"
            (click)="updateOrderStatus(order.id, 'served')"
          >
            Mark as Served
          </button>
        }
      </div>
    </div>
  </div>
}
