<div class="search-container">
  <input
    type="text"
    class="tonic-input"
    placeholder="Search for a drink..."
    [ngModel]="searchTerm()"
    (ngModelChange)="searchTerm.set($event)"
  />
</div>

@if (isLoading()) {
  <div class="loading-state">Loading drinks...</div>
} @else if (hasError()) {
  <div class="error-message">An error occurred while fetching the drinks.</div>
} @else {
  <!-- UPDATED: Use filteredDrinks() instead of drinks() -->
  <div id="menu-grid" class="menu-grid">
    @for (drink of filteredDrinks(); track drink.id) {
      <div
        class="drink-card"
        [class.is-expanded]="expandedDrinkId() === drink.id"
      >
        <!-- Hidden checkbox for model binding -->
        <input type="checkbox" [id]="drink.id" [(ngModel)]="drink.isSelected" />

        <div class="card-main" (click)="toggleDetails(drink.id)">
          <img
            [src]="drink.image_url"
            alt="{{ drink.name }}"
            class="drink-image"
            loading="lazy"
            onerror="this.src='https://placehold.co/100x100/44403c/a8a29e?text=PD'"
          />
          <div class="drink-summary">
            <h3 class="drink-name">{{ drink.name }}</h3>
            <p class="drink-tagline">
              {{ drink.description }}
            </p>
          </div>
        </div>

        <!-- Custom Toggle Switch -->
        <div class="toggle-container">
          <label class="toggle-label" (click)="$event.stopPropagation()">
            <input
              type="checkbox"
              class="sr-only"
              [checked]="drink.isSelected"
              (change)="toggleSelection(drink)"
            />
            <div class="toggle-switch"></div>
          </label>
        </div>
      </div>

      <!-- Expanded Details Panel -->
      <div
        class="details-panel"
        [class.is-open]="expandedDrinkId() === drink.id"
      >
        <pd-drink-details [drink]="drink"></pd-drink-details>
      </div>
    } @empty {
      <!-- NEW: Empty state for when no drinks match the search -->
      <div class="empty-search-results">
        <p>No drinks found for "{{ searchTerm() }}".</p>
      </div>
    }
  </div>
}
