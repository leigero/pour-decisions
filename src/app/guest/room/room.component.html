<!-- "Guest Gate" Modal (no changes) -->
@if (showJoinModal()) {
  <pd-join-room-modal
    [roomName]="room()!.name"
    (joinRoom)="handleJoinRoom($event)"
  />
}

<!-- The main room content -->
<div class="room-container">
  @if (room() && guest()) {
    <!-- Room and User Info Card (no changes) -->
    <pd-room-header
      [room]="room()!"
      [guest]="guest()!"
      (guestUpdated)="handleGuestUpdate($event)"
    ></pd-room-header>

    <!-- Main content area for lobby/menu -->
    <div class="content">
      <div class="tabs">
        <button
          class="tab-button"
          [class.active]="view() === 'menu'"
          (click)="navigate('menu')"
        >
          Menu
        </button>
        <button
          class="tab-button"
          [class.active]="view() === 'orders'"
          (click)="navigate('orders')"
        >
          Live Orders
        </button>
      </div>
      <div class="tab-content">
        @switch (view()) {
          @case ("orders") {
            <pd-lobby
              [room]="room()!"
              [orders]="orders()"
              (openMenu)="navigate('menu')"
              (viewOrder)="viewOrderDetails($event)"
            ></pd-lobby>
          }
          @case ("menu") {
            <pd-menu
              [room]="room()!"
              (toLobby)="navigate('menu')"
              (orderDrink)="orderDrink($event)"
              (viewDrink)="viewDrinkDetails($event)"
            ></pd-menu>
          }
        }
      </div>
    </div>
  } @else if (!showJoinModal()) {
    <!-- Loading state -->
    <div class="main-info-card loading-card">
      <h1 class="section-title">Loading Room...</h1>
    </div>
  }
</div>

@if (selectedOrder(); as order) {
  <pd-order-details-modal
    [order]="order"
    (close)="closeOrderModal()"
    (cancelOrder)="cancelOrder($event)"
  />
}

@if (selectedDrink(); as drink) {
  <pd-modal class="modal-contents" (close)="closeDrinkModal()">
    <pd-drink-details [drink]="drink"></pd-drink-details>
    <label for="orderNotes">Special Requests</label>
    <textarea
      id="orderNotes"
      class="pd-textarea"
      placeholder="Optional"
    ></textarea>

    <div class="modal-actions">
      <button class="pd-button secondary" (click)="closeDrinkModal()">
        Close
      </button>
      <button class="pd-button" (click)="orderDrink(drink.id)">
        Order Drink
      </button>
    </div>
  </pd-modal>
}
