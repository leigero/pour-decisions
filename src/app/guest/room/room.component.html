<!-- "Guest Gate" Modal (no changes) -->
@if (showJoinModal()) {
  <div class="modal-backdrop">
    <div class="modal-content">
      <h2 class="modal-title">Join "{{ room()?.name }}"</h2>
      <div class="modal-body">
        <p class="modal-description">
          To join the room and place orders, please enter your name below.
        </p>
        <input
          type="text"
          placeholder="Enter Your Name"
          class="modal-input"
          [(ngModel)]="newGuestName"
          (keyup.enter)="handleJoinRoom()"
        />
      </div>
      <div class="modal-actions">
        <button
          class="pd-button"
          (click)="handleJoinRoom()"
          [disabled]="!newGuestName()"
        >
          Join Room
        </button>
      </div>
    </div>
  </div>
}

<!-- The main room content -->
<div class="room-container">
  @if (room() && guest()) {
    <!-- Room and User Info Card (no changes) -->
    <div class="main-info-card">
      <div class="header">
        <h1 class="section-title">
          {{ room()?.name || "Loading..." }}
        </h1>
        <div class="user-profile">
          <img
            [src]="guest()!.profile_picture"
            [alt]="guest()!.display_name + 's profile photo'"
            class="profile-photo"
          />
          <span class="user-name">{{ guest()!.display_name }}</span>
          <button class="edit-button">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
              <path d="m15 5 4 4" />
            </svg>
          </button>
        </div>
      </div>
      <p class="section-description">{{ room()?.description || "" }}</p>
      <div class="room-code-container">
        <span class="room-code-label">Room Code:</span>
        <p class="room-code">{{ room()?.code || "Loading..." }}</p>
      </div>
    </div>

    <!-- Main content area for lobby/menu -->
    <div class="content">
      @switch (view()) {
        @case ("main") {
          <pd-lobby
            [room]="room()!"
            [orders]="orders()"
            (openMenu)="navigate('menu')"
            (viewOrder)="viewOrderDetails($event)"
          ></pd-lobby>
        }
        @case ("menu") {
          <pd-menu
            [room]="room()!"
            (toLobby)="navigate('main')"
            (orderDrink)="orderDrink($event)"
          ></pd-menu>
        }
      }
    </div>
  } @else if (!showJoinModal()) {
    <!-- Loading state -->
    <div class="main-info-card loading-card">
      <h1 class="section-title">Loading Room...</h1>
    </div>
  }
</div>

<!-- UPDATED: Order Details Modal for the Guest -->
@if (selectedOrder(); as order) {
  <div class="modal-backdrop" (click)="closeOrderModal()">
    <div class="modal-panel" (click)="$event.stopPropagation()">
      <!-- NEW: Image Container -->
      <div class="modal-image-container">
        <img
          [src]="order.drink.image_url"
          [alt]="order.drink.name"
          class="modal-drink-image"
          onerror="this.src='https://placehold.co/300x300/374151/9ca3af?text=No+Image'"
        />
      </div>

      <div class="modal-header">
        <h3 class="modal-title">{{ order.drink.name }}</h3>
        <span class="order-status" [ngClass]="'status-' + order.status">{{
          order.status
        }}</span>
      </div>

      <div class="modal-body">
        <!-- NEW: Drink Description -->
        <p class="modal-description">{{ order.drink.description }}</p>

        <!-- NEW: Ingredients List -->
        <div class="ingredients-section">
          <h4 class="ingredients-title">Ingredients</h4>
          <ul class="ingredients-list">
            @for (ingredient of order.drink.ingredients; track ingredient) {
              <li class="ingredient-item">{{ ingredient }}</li>
            }
          </ul>
        </div>

        <div class="detail-item">
          <span class="detail-label">Ordered At:</span>
          <span class="detail-value">{{
            order.created_at | date: "shortTime"
          }}</span>
        </div>
      </div>

      <div class="modal-actions">
        <button class="pd-button secondary" (click)="closeOrderModal()">
          Close
        </button>
        @if (order.status === "queued" || order.status === "in-progress") {
          <button class="pd-button danger" (click)="cancelOrder(order.id)">
            Cancel Order
          </button>
        }
      </div>
    </div>
  </div>
}
